@using BitcoinApp.Client.Models.LiveData

@model LiveDataViewModel

@{
    ViewData["Title"] = "Live Data";
}

<div class="text-center">
    <h2>Live Data</h2>
    <div id="liveDataGrid">
        @await Html.PartialAsync("_LiveDataGrid", Model.Grid)
    </div>
</div>

<script type="text/javascript">

    function RefreshLiveDataGrid() {

        $.ajax({
            type: 'GET',
            url: '@Url.Action("GetGridView")',
            success: function (response) { $('#liveDataGrid').html(response); },
            failure: function (response) { console.error('GetGridView ajax failure'); },
            error: function (response) { console.error('GetGridView ajax error'); }
        });
    }

    function OnSaveLiveData(id, el) {

        $.ajax({
            type: 'POST',
            url: '@Url.Action("SaveLiveData")',
            data: JSON.stringify({ "Id": id }),
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json; charset=UTF-8'
            },
            success: function (response) {
                if (response == true) {
                    $(el).parent().parent().addClass('live-already-saved');
                    $(el).remove();
                }
            },
            failure: function (response) { console.error('OnSaveLiveData ajax failure'); },
            error: function (response) { console.error('OnSaveLiveData ajax error'); }
        });
    }

    var periodicRefresh = window.setInterval(function() {
        RefreshLiveDataGrid();
    }, 30000);

</script>