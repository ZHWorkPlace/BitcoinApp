@using BitcoinApp.Client.Models.LiveData

@model LiveDataViewModel

@{
    ViewData["Title"] = "Live Data";
}

<div class="text-center">
    <div id="liveDataGrid">
        @await Html.PartialAsync("_LiveDataGrid", Model.Grid)
    </div>
</div>

<script type="text/javascript">

    function RefreshLiveDataGrid() {

        $.ajax({
            type: 'GET',
            url: '@Url.Action("GetGridView")',
            success: function (response) { $('#liveDataGrid').html(response); },
            failure: function (response) { console.error('GetGridView ajax failure'); },
            error: function (response) { console.error('GetGridView ajax error'); }
        });
    }

    function OnSaveLiveData(retrievedAt, el) {

        var data = {
            "retrievedAt": retrievedAt
        };

        //console.log('el = ' + el.parent().html());
        $.ajax({
            type: 'POST',
            url: '@Url.Action("SaveLiveData")',
            data: JSON.stringify(data),
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            success: function (response) {

               console.log('reponse = ' + response);
            },
            failure: function (response) { console.error('OnSaveLiveData ajax failure'); },
            error: function (response) { console.error('OnSaveLiveData ajax error'); }
        });
    }

    var periodicRefresh = window.setInterval(function() {
        RefreshLiveDataGrid();
    }, 30000);

</script>